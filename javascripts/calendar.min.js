/*! calendar 2014-07-19 */
function Calendar(a){this._container=document.getElementById(a.containerId),this._selectDateEvent=a.selectDate,this.init(),this.renderDOM(),this.bindDOM(),this._selectDateEvent&&this.selectDateEvent()}function fillSkipUl(a,b){b.innerHTML="";for(var c=a-2;a+2>=c;c++){var d=document.createElement("li");d.innerHTML=c,b.appendChild(d)}$(b).children().eq(2).addClass("selected")}function getDaysOfMonth(a){return new Date(a.getFullYear(),a.getMonth()+1,0).getDate()}function generateMonObj(a){return new Date(a.month+",1,"+a.year)}function getMonAttr(a){a.Date=new Date(a.month+",1,"+a.year),a.dayOfMonBegin=a.Date.getDay(),a.daysOfMon=getDaysOfMonth(a.Date),a.dayOfMonEnd=new Date(a.month+","+a.daysOfMon+","+a.year)}function getMonthes(){var a={},b={},c={},d={};return a.year=document.getElementById("curYear").innerHTML,a.month=document.getElementById("curMonth").innerHTML,getMonAttr(a),1===parseInt(a.month)?(b.year=parseInt(a.year)-1,b.month=12):(b.year=a.year,b.month=parseInt(a.month)-1),getMonAttr(b),1===parseInt(b.month)?(c.year=parseInt(b.year)-1,c.month=12):(c.year=b.year,c.month=parseInt(b.month)-1),getMonAttr(c),12===parseInt(a.month)?(d.year=parseInt(a.year)+1,d.month=1):(d.year=a.year,d.month=parseInt(a.month)+1),getMonAttr(d),{cur:a,last:b,beforeLast:c,next:d}}function addListener(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function fade(a,b,c){var d="show"==b?0:100,e=window.ActiveXObject?!0:!1,f=setInterval(function(){"show"==b?100>d?(d+=10,e?a.style.cssText="filter:alpha(opacity="+d+")":a.style.opacity=100==d?1:"0."+d):(clearTimeout(f),c&&c()):d>0?(d-=10,e?a.style.cssText="filter:alpha(opacity="+d+")":a.style.opacity="0."+d):(clearTimeout(f),c&&c())},30)}Calendar.prototype.init=function(){this._calendarWrap=document.createElement("div"),this._calendarWrap.id="calendar",this._table=document.createElement("table"),this._caption=document.createElement("caption"),this.time={},this.time.Date=new Date,this.time.year=this.time.Date.getFullYear(),this.time.month=this.time.Date.getMonth()+1,this.time.date=this.time.Date.getDate(),this.time.day=this.time.Date.getDay(),this._skipObj=document.createElement("div"),this._skipObj.id="skipObj",this._skipObj.className="hide",this._skipShade=document.createElement("div"),this._skipShade.id="skip_shade",this._skip=document.createElement("div"),this._skip.id="skip",this._skipHeader=document.createElement("div"),this._skipHeader.className="skip_header",this._skipHeader.innerHTML="跳转日期",this._skipWrap=document.createElement("div"),this._skipWrap.className="skip_wrap",this._skipYear=document.createElement("div"),this._skipYear.id="skip_year",this._skipYearUl=document.createElement("ul"),this._skipYearUl.id="skip_year_ul",this._skipYear.appendChild(this._skipYearUl),this._skipMonth=document.createElement("div"),this._skipMonth.id="skip_month",this._skipMonthUl=document.createElement("ul"),this._skipMonthUl.id="skip_month_ul",this._skipMonth.appendChild(this._skipMonthUl),this._skipSelect=document.createElement("div"),this._skipSelect.className="skip_select",this._skipSelectYear=document.createElement("span"),this._skipSelectYear.className="year",this._skipSelectYear.innerHTML="年",this._skipSelectMonth=document.createElement("span"),this._skipSelectMonth.className="month",this._skipSelectMonth.innerHTML="月",this._skipSelect.appendChild(this._skipSelectYear),this._skipSelect.appendChild(this._skipSelectMonth),this._skipWrap.appendChild(this._skipYear),this._skipWrap.appendChild(this._skipMonth),this._skipWrap.appendChild(this._skipSelect),this._skipEvent=document.createElement("div"),this._skipEvent.className="skip_event",this._skipEventCancel=document.createElement("div"),this._skipEventCancel.className="skip_cancel",this._skipEventCancel.innerHTML="取消",this._skipEventGo=document.createElement("div"),this._skipEventGo.className="skip_go",this._skipEventGo.innerHTML="跳转",this._skipEvent.appendChild(this._skipEventCancel),this._skipEvent.appendChild(this._skipEventGo),this._skip.appendChild(this._skipHeader),this._skip.appendChild(this._skipWrap),this._skip.appendChild(this._skipEvent),this._skipObj.appendChild(this._skipShade),this._skipObj.appendChild(this._skip),this._calendarWrap.appendChild(this._skipObj),fillSkipUl(this.time.year,this._skipYearUl),fillSkipUl(this.time.month,this._skipMonthUl)},Calendar.prototype.createMonContent=function(a){var b=document.createElement("tbody");b.setAttribute("class",a.classObj);for(var c=0,d="<tr>",e=!1,f="",g=a.curObj.dayOfMonBegin-1;g>=0;g--)f="<td class='notCurMon last'>"+(a.lastObj.daysOfMon-g)+"</td>",d+=f,c+=1;this.time.year===parseInt(a.curObj.year)&&this.time.month===parseInt(a.curObj.month)&&(e=!0);for(var h=1;h<=a.curObj.daysOfMon;h++)f=e&&this.time.date===h?"<td class='today'>"+h+"</td>":"<td>"+h+"</td>",d+=f,c+=1,c%7===0&&(c=0,d+="</tr>",h!=a.curObj.daysOfMon&&(d+="<tr>"));if((a.curObj.dayOfMonEnd+1)%7!==0)for(var i=1;c%7!==0;i+=1)f="<td class='notCurMon next'>"+i+"</td>",d+=f,c+=1,c%7===0&&(c=0,d+="</tr>");b.innerHTML=d,this._table.appendChild(b)},Calendar.prototype.createCaption=function(a){var b="",c="";if("string"==typeof a){var d=document.getElementById("curYear").innerHTML,e=document.getElementById("curMonth").innerHTML;if("last"===a)1===parseInt(e)?(b=parseInt(d)-1,c=12):(b=d,c=parseInt(e)-1);else if("next"===a)12===parseInt(e)?(b=parseInt(d)+1,c=1):(b=d,c=parseInt(e)+1);else if("getCur"===a)return{year:parseInt(d),month:parseInt(e)}}else b=a.getFullYear(),c=a.getMonth(),c+=1;this._caption.innerHTML="<span id='curYear'>"+b+"</span> 年 <span id='curMonth'>"+c+"</span> 月"},Calendar.prototype.createMonBody=function(){var a=this.monthes,b={curObj:a.last,lastObj:a.beforeLast,classObj:"monBlock lastMon"},c={curObj:a.cur,lastObj:a.last,classObj:"monBlock curMon"},d={curObj:a.next,lastObj:a.cur,classObj:"monBlock nextMon"};this.createMonContent(b),this.createMonContent(c),this.createMonContent(d)},Calendar.prototype.renderDOM=function(){var a=document.createElement("tbody"),b='<tr class="week"><td>SUN</td><td>MON</td><td>TUE</td><td>WED</td><td>THU</td><td>FRI</td><td>SAT</td></tr>';a.innerHTML=b,this._table.appendChild(a),this.createCaption(this.time.Date),this._table.appendChild(this._caption),this._calendarWrap.appendChild(this._table),this._container.appendChild(this._calendarWrap),this.monthes=getMonthes(),this.createMonBody()},Calendar.prototype.bindDOM=function(){function a(a){e=a.touches[0].pageY,""===e&&(e+=j*i),q=0,r=0}function b(a,b,c){if(a.preventDefault(),f=a.touches[0].pageY,g=f-e,g>0)for(;g/30>q;){var d=$(b).children().first().html(),h=document.createElement("li");h.innerHTML="month"===c&&parseInt(d)-1===0?12:parseInt(d)-1,j+=1,h.style.cssText="-webkit-transform:translate3d(0,"+(g+j*i)+"px,0)",b.insertBefore(h,b.firstChild),q+=1,$(b).children().last().remove()}else for(;-g/45>r;){var k=$(b).children().last().html(),h=document.createElement("li");h.innerHTML="month"===c&&parseInt(k)+1===13?1:parseInt(k)+1,j-=1,h.style.cssText="-webkit-transform:translate3d(0,"+(g+j*i)+"px,0)",b.appendChild(h),r+=1,$(b).children().first().remove()}for(var l=$(b).children(),m=0,n=l.length;n>m;m++)l.eq(m)[0].style.cssText="-webkit-transform:translate3d(0,"+(g+(r-q)*i)+"px,0)";$(b).find(".selected").removeClass("selected")}function c(a,b){h=a.changedTouches[0].pageY,g=h-e,$(b).children().eq(2).addClass("selected");for(var c=$(b).children(),d=0,f=c.length;f>d;d++)c.eq(d)[0].style.cssText="-webkit-transform:translate3d(0,0,0)"}var d=this,e="",f="",g="",h="",i=30,j=0,k=this._skipYear,l=this._skipYearUl,m=this._skipMonth,n=this._skipMonthUl,o=this._skipEventCancel,p=this._skipEventGo,q=0,r=0;$(".curMon").show(),$("body").on("swipeRight","tbody",function(){var a=$(".lastMon");a.removeClass("animated fadeInRight fadeInLeft"),a.addClass("animated fadeInLeft"),$(this).hide(),a.show(),a[0].addEventListener("webkitAnimationEnd",function(){a.removeClass("animated fadeInLeft"),a[0].removeEventListener("webkitAnimationEnd")},!1),$(".nextMon").remove(),$(".curMon").addClass("nextMon").removeClass("curMon"),a.addClass("curMon").removeClass("lastMon"),d.createCaption("last"),d.monthes=getMonthes();var b={curObj:d.monthes.last,lastObj:d.monthes.beforeLast,classObj:"monBlock lastMon"};d.createMonContent(b)}).on("swipeLeft","tbody",function(){var a=$(".nextMon");a.removeClass("animated fadeInRight fadeInLeft"),a.addClass("animated fadeInRight"),$(this).hide(),a.show(),a[0].addEventListener("webkitAnimationEnd",function(){a.removeClass("animated fadeInRight"),a[0].removeEventListener("webkitAnimationEnd")},!1),$(".lastMon").remove(),$(".curMon").addClass("lastMon").removeClass("curMon"),a.addClass("curMon").removeClass("nextMon"),d.createCaption("next"),d.monthes=getMonthes();var b={curObj:d.monthes.next,lastObj:d.monthes.cur,classObj:"monBlock nextMon"};d.createMonContent(b)}),addListener(k,"touchstart",function(b){a(b)}),addListener(k,"touchmove",function(a){b(a,l,"year")}),addListener(k,"touchend",function(a){c(a,l)}),addListener(m,"touchstart",function(b){a(b)}),addListener(m,"touchmove",function(a){b(a,n,"month")}),addListener(m,"touchend",function(a){c(a,n)}),addListener(o,"touchstart",function(){$(o).addClass("yes")}),addListener(o,"touchend",function(){$(o).removeClass("yes"),d._skipObj.className="hide"}),addListener(p,"touchstart",function(){$(p).addClass("yes")}),addListener(p,"touchend",function(){$(p).removeClass("yes");var a={year:parseInt($("#skip_year_ul>.selected").html()),month:parseInt($("#skip_month_ul>.selected").html())},b=generateMonObj(a);d.createCaption(b),d.monthes=getMonthes(),$(".monBlock").remove(),d.createMonBody(),$(".curMon").show(),fade(d._skipObj,"hiden",function(){d._skipObj.className="hide",d._skipObj.style.opacity=1})}),$(d._caption).on("longTap",function(){d._skipObj.className="";var a=d.createCaption("getCur");fillSkipUl(parseInt(a.year),d._skipYearUl),fillSkipUl(parseInt(a.month),d._skipMonthUl)})},Calendar.prototype.selectDateEvent=function(){var a=this;$("body").on("tap","tbody.monBlock td",function(){var b=a.createCaption("getCur"),c=parseInt($(this).html());$(this).hasClass("notCurMon")&&($(this).hasClass("last")?b.month-1===0?(b.month=12,b.year-=1):b.month-=1:$(this).hasClass("next")&&(b.month+1===13?(b.month=1,b.year+=1):b.month+=1)),b.date=c,console.log("curTime :",b),a._selectDateEvent.call(void 0,b)})};